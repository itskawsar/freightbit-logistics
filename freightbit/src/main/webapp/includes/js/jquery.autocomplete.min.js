jQuery.autocomplete=function(e,t){function a(){M={},M.data={},M.length=0}function n(){if(46==F||F>8&&32>F)return b.hide();var e=S.val();e!=V&&(V=e,e.length>=t.minChars?(S.addClass(t.loadingClass),v(e)):(S.removeClass(t.loadingClass),b.hide()))}function r(e){var t=$("li",T);t&&(E+=e,0>E?E=0:E>=t.size()&&(E=t.size()-1),t.removeClass("ac_over"),$(t[E]).addClass("ac_over"))}function l(){var e=$("li.ac_over",T)[0];if(!e){var a=$("li",T);t.selectOnly?1==a.length&&(e=a[0]):t.selectFirst&&(e=a[0])}return e?(s(e),!0):!1}function s(a){a||(a=document.createElement("li"),a.extra=[],a.selectValue="");var n=$.trim(a.selectValue?a.selectValue:a.innerHTML);e.lastSelected=n,V=n,b.html(""),S.val(n),f(),t.onItemSelect&&setTimeout(function(){t.onItemSelect(a)},1)}function o(e,t){var a=S.get(0);if(a.createTextRange){var n=a.createTextRange();n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t),n.select()}else a.setSelectionRange?a.setSelectionRange(e,t):a.selectionStart&&(a.selectionStart=e,a.selectionEnd=t);a.focus()}function i(e){8!=F&&(S.val(S.val()+e.substring(V.length)),o(V.length,e.length))}function c(){var a=y(e),n=t.width>0?t.width:S.width();b.css({width:parseInt(n)+"px",top:a.y+e.offsetHeight+"px",left:a.x+"px"}).show()}function u(){I&&clearTimeout(I),I=setTimeout(f,200)}function f(){if(I&&clearTimeout(I),S.removeClass(t.loadingClass),b.is(":visible")&&b.hide(),t.mustMatch){var a=S.val();a!=e.lastSelected&&s(null)}}function h(e,a){if(a){if(S.removeClass(t.loadingClass),T.innerHTML="",!_||0==a.length)return f();$.browser.msie&&b.append(document.createElement("iframe")),T.appendChild(d(a)),t.autoFill&&S.val().toLowerCase()==e.toLowerCase()&&i(a[0][0]),c()}else f()}function m(e){if(!e)return null;for(var a=[],n=e.split(t.lineSeparator),r=0;r<n.length;r++){var l=$.trim(n[r]);l&&(a[a.length]=l.split(t.cellSeparator))}return a}function d(e){var a=document.createElement("ul"),n=e.length;t.maxItemsToShow>0&&t.maxItemsToShow<n&&(n=t.maxItemsToShow);for(var r=0;n>r;r++){var l=e[r];if(l){var o=document.createElement("li");t.formatItem?(o.innerHTML=t.formatItem(l,r,n),o.selectValue=l[0]):(o.innerHTML=l[0],o.selectValue=l[0]);var i=null;if(l.length>1){i=[];for(var c=1;c<l.length;c++)i[i.length]=l[c]}o.extra=i,a.appendChild(o),$(o).hover(function(){$("li",a).removeClass("ac_over"),$(this).addClass("ac_over"),E=$("li",a).indexOf($(this).get(0))},function(){$(this).removeClass("ac_over")}).click(function(e){e.preventDefault(),e.stopPropagation(),s(this)})}}return a}function v(e){t.matchCase||(e=e.toLowerCase());var a=t.cacheLength?C(e):null;a?h(e,a):"string"==typeof t.url&&t.url.length>0?$.get(g(e),function(t){t=m(t),x(e,t),h(e,t)}):S.removeClass(t.loadingClass)}function g(e){var a=t.url+"?q="+encodeURI(e);for(var n in t.extraParams)a+="&"+n+"="+encodeURI(t.extraParams[n]);return a}function C(e){if(!e)return null;if(M.data[e])return M.data[e];if(t.matchSubset)for(var a=e.length-1;a>=t.minChars;a--){var n=e.substr(0,a),r=M.data[n];if(r){for(var l=[],s=0;s<r.length;s++){var o=r[s],i=o[0];p(i,e)&&(l[l.length]=o)}return l}}return null}function p(e,a){t.matchCase||(e=e.toLowerCase());var n=e.indexOf(a);return-1==n?!1:0==n||t.matchContains}function w(e,a){a&&S.removeClass(t.loadingClass);for(var n=a?a.length:0,r=null,l=0;n>l;l++){var s=a[l];if(s[0].toLowerCase()==e.toLowerCase()){r=document.createElement("li"),t.formatItem?(r.innerHTML=t.formatItem(s,l,n),r.selectValue=s[0]):(r.innerHTML=s[0],r.selectValue=s[0]);var o=null;if(s.length>1){o=[];for(var i=1;i<s.length;i++)o[o.length]=s[i]}r.extra=o}}t.onFindValue&&setTimeout(function(){t.onFindValue(r)},1)}function x(e,n){n&&e&&t.cacheLength&&(!M.length||M.length>t.cacheLength?(a(),M.length++):M[e]||M.length++,M.data[e]=n)}function y(e){for(var t=e.offsetLeft||0,a=e.offsetTop||0;e=e.offsetParent;)t+=e.offsetLeft,a+=e.offsetTop;return{x:t,y:a}}var L=this,S=$(e).attr("autocomplete","off");t.inputClass&&S.addClass(t.inputClass);var T=document.createElement("div"),b=$(T);b.hide().addClass(t.resultsClass).css("position","absolute"),t.width>0&&b.css("width",t.width),$("body").append(T),e.autocompleter=L;var I=null,V="",E=-1,M={},_=!1,F=null;if(a(),null!=t.data){var P="",k={},H=[];"string"!=typeof t.url&&(t.cacheLength=1);for(var j=0;j<t.data.length;j++)H="string"==typeof t.data[j]?[t.data[j]]:t.data[j],H[0].length>0&&(P=H[0].substring(0,1).toLowerCase(),k[P]||(k[P]=[]),k[P].push(H));for(var O in k)t.cacheLength++,x(O,k[O])}S.keydown(function(e){switch(F=e.keyCode,e.keyCode){case 38:e.preventDefault(),r(-1);break;case 40:e.preventDefault(),r(1);break;case 9:case 13:l()&&(S.get(0).blur(),e.preventDefault());break;default:E=-1,I&&clearTimeout(I),I=setTimeout(function(){n()},t.delay)}}).focus(function(){_=!0}).blur(function(){_=!1,u()}),f(),this.flushCache=function(){a()},this.setExtraParams=function(e){t.extraParams=e},this.findValue=function(){var e=S.val();t.matchCase||(e=e.toLowerCase());var a=t.cacheLength?C(e):null;a?w(e,a):"string"==typeof t.url&&t.url.length>0?$.get(g(e),function(t){t=m(t),x(e,t),w(e,t)}):w(e,null)}},jQuery.fn.autocomplete=function(e,t,a){return t=t||{},t.url=e,t.data="object"==typeof a&&a.constructor==Array?a:null,t.inputClass=t.inputClass||"ac_input",t.resultsClass=t.resultsClass||"ac_results",t.lineSeparator=t.lineSeparator||"\n",t.cellSeparator=t.cellSeparator||"|",t.minChars=t.minChars||1,t.delay=t.delay||400,t.matchCase=t.matchCase||0,t.matchSubset=t.matchSubset||1,t.matchContains=t.matchContains||0,t.cacheLength=t.cacheLength||1,t.mustMatch=t.mustMatch||0,t.extraParams=t.extraParams||{},t.loadingClass=t.loadingClass||"ac_loading",t.selectFirst=t.selectFirst||!1,t.selectOnly=t.selectOnly||!1,t.maxItemsToShow=t.maxItemsToShow||-1,t.autoFill=t.autoFill||!1,t.width=parseInt(t.width,10)||0,this.each(function(){var e=this;new jQuery.autocomplete(e,t)}),this},jQuery.fn.autocompleteArray=function(e,t){return this.autocomplete(null,t,e)},jQuery.fn.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1};